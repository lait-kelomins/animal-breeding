{
  "$Comment": "Patch Template_Animal_Neutral to add feed/tame hints and restrict mounting to tamed animals",
  "BaseAssetPath": "NPC/Roles/_Core/Templates/Template_Animal_Neutral",
  "InteractionInstruction": {
    "Enabled": {
      "Compute": "IsHarvestable || IsMountable || !isEmptyStringArray(LovedItems)"
    },
    "Instructions": [
      {
        "$Comment": "Add Feed/Tame hint instruction at the beginning",
        "_op": "add",
        "_index": 0,
        "Enabled": {
          "Compute": "!isEmptyStringArray(LovedItems)"
        },
        "Instructions": [
          {
            "$Comment": "Disable if player not holding LovedItem",
            "Sensor": {
              "Type": "Not",
              "Sensor": {
                "Type": "Target",
                "Filters": [
                  {
                    "Type": "ItemInHand",
                    "Items": {
                      "Compute": "LovedItems"
                    }
                  }
                ]
              }
            },
            "Actions": [
              {
                "Type": "SetInteractable",
                "Interactable": false
              }
            ]
          },
          {
            "$Comment": "Show tame hint for wild animals (Neutral/Friendly attitude)",
            "Sensor": {
              "Type": "CanInteract",
              "ViewSector": 360,
              "Attitudes": ["Neutral", "Friendly"]
            },
            "Actions": [
              {
                "Type": "SetInteractable",
                "Interactable": true,
                "Hint": "server.interactionHints.tame"
              }
            ]
          },
          {
            "$Comment": "Show feed hint for tamed animals (Revered attitude)",
            "Sensor": {
              "Type": "CanInteract",
              "ViewSector": 360,
              "Attitudes": ["Revered"]
            },
            "Actions": [
              {
                "Type": "SetInteractable",
                "Interactable": true,
                "Hint": "server.interactionHints.feed"
              }
            ]
          }
        ]
      },
      {
        "$Comment": "Modify mounting to only work for Revered (tamed) animals",
        "_find": "$[?(@.Enabled.Compute == 'IsMountable')]",
        "_op": "replace",
        "Enabled": {
          "Compute": "IsMountable"
        },
        "Instructions": [
          {
            "$Comment": "Only allow mounting for Revered attitude",
            "Sensor": {
              "Type": "Not",
              "Sensor": {
                "Type": "CanInteract",
                "ViewSector": 360,
                "Attitudes": ["Revered"]
              }
            },
            "Actions": [
              {
                "Type": "SetInteractable",
                "Interactable": false
              }
            ]
          },
          {
            "Enabled": {
              "Compute": "!isEmptyStringArray(LovedItems)"
            },
            "$Comment": "Hide mount hint if holding LovedItem (feed takes priority)",
            "Sensor": {
              "Type": "Target",
              "Filters": [
                {
                  "Type": "ItemInHand",
                  "Items": {
                    "Compute": "LovedItems"
                  }
                }
              ]
            },
            "Actions": [
              {
                "Type": "SetInteractable",
                "Interactable": false
              }
            ]
          },
          {
            "Continue": true,
            "Sensor": {
              "Type": "Any"
            },
            "Actions": [
              {
                "Type": "SetInteractable",
                "Interactable": true,
                "Hint": "server.interactionHints.mount"
              }
            ]
          },
          {
            "Sensor": {
              "Type": "HasInteracted"
            },
            "Actions": [
              {
                "Type": "Mount",
                "AnchorX": {
                  "Compute": "MountAnchorX"
                },
                "AnchorY": {
                  "Compute": "MountAnchorY"
                },
                "AnchorZ": {
                  "Compute": "MountAnchorZ"
                },
                "MovementConfig": {
                  "Compute": "MountMovementConfig"
                }
              }
            ]
          }
        ]
      }
    ]
  }
}
